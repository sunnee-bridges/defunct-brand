---
// src/pages/data.astro
import Base from "../layouts/Base.astro";

// Visible price label on buttons
const PRICE_LABEL = import.meta.env.PUBLIC_PRICE_LABEL || "$9";

// Where checkout actually happens
const BUY_PATH = "/buy";

// Free sample
const sampleCsvHref = "/data/brands-sample.csv";

// (Optional) show an old “latest” preview (OFF by default)
const SHOW_LATEST = (import.meta.env.PUBLIC_SHOW_LATEST || "0") === "1";
const latestCsvHref = "/data/brands-latest.csv";

// Schema rows
const schema: Array<[string, string, string]> = [
  ["brand","string","Brand name"],
  ["slug","string","URL-safe unique key"],
  ["category","string","Primary category (e.g., Consumer electronics)"],
  ["country","string|null","Primary country/market (if known)"],
  ["active_start","int|null","Year founded/started"],
  ["active_end","int|null","Year ended (if known)"],
  ["fate","string|null","Outcome (e.g., Bankrupt, Acquired)"],
  ["summary","string|null","One–two sentence summary"],
  ["notable_products","string","Semicolon-separated list"],
  ["wikipedia_url","string|null","Source link if available"],
  ["last_updated","date","ISO date of export (YYYY-MM-DD)"],
  ["dataset_version","string","Version tag (YYYYMMDD)"],
];
---
<Base title="Defunct Brands Dataset • CSV Downloads"
      description="Download the Defunct Brands dataset as CSV. Clean, structured data of discontinued brands with category, active years, and fate.">

  <nav class="mb-4 flex flex-wrap gap-2">
    <a href="/" class="chip focus-ring">← Home</a>
    <a href="/az/" class="chip focus-ring">A–Z</a>
    <a href="/decade/" class="chip focus-ring">Decades</a>
  </nav>

  <h1 class="text-2xl md:text-3xl font-bold mb-2">Defunct Brands Dataset</h1>
  <p class="text-slate-700 dark:text-slate-300 mb-4">
    A cleaned CSV of brands, categories, active years, and fate.
  </p>

  <div class="grid gap-4 md:grid-cols-2 md:gap-4 lg:gap-6">
    <!-- Free sample -->
    <section class="rounded-xl border p-4 bg-white/80 dark:bg-slate-900/80 border-slate-200 dark:border-slate-700">
      <h2 class="text-lg font-semibold mb-2">Free sample (7 rows)</h2>
      <p class="text-sm text-slate-600 dark:text-slate-400 mb-3">
        A tiny slice for evaluation and non-commercial use.
      </p>
      <a
        class="btn-primary focus-ring"
        href={sampleCsvHref}
        download
        aria-label="Download sample CSV (7 rows)"
        title="Download sample CSV (7 rows)"
      >
        Download sample CSV
      </a>
    </section>

    <!-- Full dataset -->
    <section class="rounded-xl border p-4 bg-white/80 dark:bg-slate-900/80 border-slate-200 dark:border-slate-700">
      <h2 class="text-lg font-semibold mb-2">Full dataset (CSV)</h2>
      <p class="text-sm text-slate-600 dark:text-slate-400 mb-3">
        One-time purchase; includes commercial license. Checkout securely with PayPal.
      </p>

      <a
        href={BUY_PATH}
        class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-medium no-underline focus-ring transition-colors"
        aria-label={`Buy full CSV for ${PRICE_LABEL} with PayPal`}
        title={`Buy full CSV — ${PRICE_LABEL} (PayPal)`}
      >
        <svg class="h-5 w-auto shrink-0" viewBox="0 0 48 32" fill="none" aria-hidden="true" role="img">
          <rect width="48" height="32" rx="4" fill="white" opacity="0.95"/>
          <path d="M14 8h6.5c3.8 0 6.2 2 5.6 5.5-.6 3.4-3.4 5.5-7.3 5.5h-2.1l-.9 4.5h-3.2L14 8z" fill="#003087"/>
          <path d="M20.8 10c2.4 0 3.6 1.2 3.3 3-.3 2-2.2 3-4.5 3h-2.2l.9-6h2.5z" fill="#009CDE"/>
          <path d="M26.5 8h6.5c3.8 0 6.2 2 5.6 5.5-.6 3.4-3.4 5.5-7.3 5.5h-2.1l-.9 4.5h-3.2L26.5 8z" fill="#003087"/>
          <path d="M33.3 10c2.4 0 3.6 1.2 3.3 3-.3 2-2.2 3-4.5 3h-2.2l.9-6h2.5z" fill="#009CDE"/>
        </svg>
        <span>Pay with PayPal — {PRICE_LABEL}</span>
      </a>

      {SHOW_LATEST && (
        <a
          href={latestCsvHref}
          class="chip focus-ring text-xs ml-2"
          rel="nofollow"
          title="Preview the latest dataset structure"
        >
          View latest
        </a>
      )}

      <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">
        You’ll complete payment on the <code>/buy</code> page and receive a secure one-time download link immediately after purchase.
      </p>
    </section>
  </div>

  <!-- Schema -->
  <h2 class="text-lg font-semibold mt-8 lg:mt-10 mb-2">Schema</h2>
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="border-b border-slate-200 dark:border-slate-700">
          <th class="text-left py-1 pr-3">Column</th>
          <th class="text-left py-1 pr-3">Type</th>
          <th class="text-left py-1">Description</th>
        </tr>
      </thead>
      <tbody>
        {schema.map(([name, type, desc]) => (
          <tr class="border-b border-slate-100 dark:border-slate-800">
            <td class="py-1 pr-3 font-medium">{name}</td>
            <td class="py-1 pr-3 text-slate-600 dark:text-slate-400">{type}</td>
            <td class="py-1">{desc}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </div>

  <!-- FAQ -->
  <section class="mt-6 space-y-2 text-sm text-slate-700 dark:text-slate-300">
    <details>
      <summary class="cursor-pointer font-medium">What's the file format?</summary>
      <div class="mt-1">UTF-8 CSV with a header row. New columns (if any) are appended to preserve backward compatibility.</div>
    </details>
    <details>
      <summary class="cursor-pointer font-medium">How often do you update?</summary>
      <div class="mt-1">Ad-hoc as new brands are added. Buyers can opt into annual updates.</div>
    </details>
    <details>
      <summary class="cursor-pointer font-medium">Commercial usage?</summary>
      <div class="mt-1">Yes for the full CSV (no raw redistribution). The sample is non-commercial.</div>
    </details>
  </section>

  <p class="mt-6 text-xs text-slate-600 dark:text-slate-400">
    <strong>License:</strong> Free sample under CC BY-NC 4.0. Full CSV under commercial license (no raw redistribution).
  </p>
</Base>

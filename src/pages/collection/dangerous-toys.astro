---
import Base from "../../layouts/Base.astro";
import BrandCard from "../../components/BrandCard.astro";

// Hand-picked slugs for the collection
const DANGEROUS_TOYS = [
 "sky-dancers",
  "csi-fingerprint-kit",
  "battlestar-galactica-viper",
  "austin-magic-pistol"
];

// Load all brands (curated JSON) at build time
const modules = import.meta.glob("/src/content/brands/*.json", {
  eager: true,
  import: "default",
}) as Record<string, any>;

const bySlug = new Map<string, any>();
for (const [p, mod] of Object.entries(modules)) {
  const data = (mod as any) ?? {};
  const fileSlug = (p.split("/").pop() || "").replace(/\.json$/i, "").replace(/\.public$/i, "");
  const slug = (data.slug || fileSlug || "").toLowerCase();
  if (slug && !bySlug.has(slug)) bySlug.set(slug, { ...data, slug });
}

// Keep order as listed above; only include those that exist
const items = DANGEROUS_TOYS
  .map((s) => bySlug.get(s))
  .filter(Boolean);

const title = "üö® 10 Dangerous Toys That Were Discontinued";
const desc  = "From lawn darts to magnet toys‚Äîten infamous products that were recalled, restricted, or banned.";
const canonical = Astro.site ? new URL("/collection/dangerous-toys/", Astro.site).href : "/collection/dangerous-toys/";

const itemListLd = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  name: title,
  numberOfItems: items.length,
  itemListOrder: "http://schema.org/ItemListOrderAscending",
  itemListElement: items.map((b: any, i: number) => ({
    "@type": "ListItem",
    position: i + 1,
    name: b.brand,
    url: Astro.site
      ? new URL(`/brand/${encodeURIComponent(b.slug)}/`, Astro.site).href
      : `/brand/${encodeURIComponent(b.slug)}/`,
  })),
};
---

<Base title={title} description={desc} canonical={canonical} jsonLd={itemListLd}>
  <nav class="mb-4">
    <a class="chip focus-ring" href="/">‚Üê Home</a>
    <a class="chip focus-ring" href="/category/">Categories</a>
  </nav>

  <h1 class="text-2xl md:text-3xl font-bold mb-2">{title}</h1>
  <p class="text-slate-700 dark:text-slate-300 mb-6">{desc}</p>

  <ul class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
    {items.map((b: any) => (
      <li class="list-none">
        <BrandCard slug={b.slug} />
      </li>
    ))}
  </ul>
</Base>

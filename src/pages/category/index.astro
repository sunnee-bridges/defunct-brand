---
import Base from "../../layouts/Base.astro";
import { slugify } from "../../lib/slug.js";

/** Load all brand JSON at build time */
const modules = import.meta.glob("/content/brands/*.json", { eager: true });
const brands = Object.values(modules).map((m: any) => m.default ?? m);

/** Build category counts */
const counts = new Map<string, number>();
for (const b of brands) {
  if (!b?.category) continue;
  counts.set(b.category, (counts.get(b.category) || 0) + 1);
}

/** Sorted categories */
const categories = Array.from(counts.entries())
  .sort((a, b) => a[0].localeCompare(b[0]));
---

<Base title="Browse by Category • Defunct Brands" description="Browse defunct brands by category.">
  <nav class="mb-4">
    <a href="/" class="chip focus-ring">← Home</a>
  </nav>

  <h1 class="text-2xl md:text-3xl font-bold mb-3">Browse by Category</h1>

  <ul class="grid grid-cols-[repeat(auto-fill,minmax(220px,1fr))] gap-2">
    {categories.map(([label, n]) => (
      <li>
        <a href={`/category/${slugify(label)}/`} class="chip focus-ring">
          {label} <span class="text-gray-500">({n})</span>
        </a>
      </li>
    ))}
  </ul>
</Base>

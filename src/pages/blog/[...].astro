---
// src/pages/blog/[...slug].astro
import { getCollection } from 'astro:content';
import Base from '@layouts/Base.astro';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
const { Content } = await article.render();

// SEO
const title = `${article.data.title} • Vanished Brands`;
const description = article.data.description;
const canonical = new URL(`/blog/${article.slug}/`, Astro.site).href;
const publishDate = article.data.publishDate.toISOString();
const image = article.data.image 
  ? new URL(article.data.image, Astro.site).href 
  : new URL('/images/default-og.jpg', Astro.site).href;

const jsonLd = [
  {
    "@context": "https://schema.org",
    "@type": "Article",
    headline: article.data.title,
    description: article.data.description,
    image: image,
    datePublished: publishDate,
    dateModified: article.data.updatedDate?.toISOString() || publishDate,
    author: {
      "@type": "Organization",
      name: "Vanished Brands",
    },
    publisher: {
      "@type": "Organization",
      name: "Vanished Brands",
      logo: {
        "@type": "ImageObject",
        url: new URL('/logo.png', Astro.site).href,
      },
    },
  },
];
---

<Base 
  title={title} 
  description={description} 
  canonical={canonical}
  jsonLd={jsonLd}
>
  <Fragment slot="head">
    <meta property="og:type" content="article" />
    <meta property="og:image" content={image} />
    <meta property="article:published_time" content={publishDate} />
    {article.data.keywords && (
      <meta name="keywords" content={article.data.keywords.join(', ')} />
    )}
  </Fragment>

  <nav class="flex flex-wrap items-center gap-2 my-3">
    <a href="/" class="chip focus-ring">← Home</a>
    <a href="/blog/" class="chip focus-ring">Blog</a>
  </nav>

  <article class="prose prose-slate dark:prose-invert max-w-4xl mx-auto">
    <Content />
  </article>

  <div class="max-w-4xl mx-auto mt-12">
    <div class="flex flex-wrap gap-2">
      <a href="/blog/" class="chip focus-ring">← All Articles</a>
      <a href="/az/" class="chip focus-ring">Browse Brands A-Z</a>
      <a href="/category/" class="chip focus-ring">Categories</a>
    </div>
  </div>
</Base>

<style is:global>
  /* Article-specific prose styling */
  .prose {
    @apply text-slate-700 dark:text-slate-300;
  }
  
  .prose h2 {
    @apply text-2xl font-bold mt-12 mb-4 text-slate-900 dark:text-slate-100;
  }
  
  .prose h3 {
    @apply text-xl font-semibold mt-8 mb-3 text-slate-900 dark:text-slate-100;
  }
  
  .prose p {
    @apply mb-4 leading-relaxed;
  }
  
  .prose ul {
    @apply my-4 space-y-2;
  }
  
  .prose li {
    @apply ml-6;
  }
  
  .prose a {
    @apply text-blue-600 dark:text-blue-400 hover:underline;
  }
  
  .prose strong {
    @apply font-semibold text-slate-900 dark:text-slate-100;
  }
  
  .prose blockquote {
    @apply border-l-4 border-blue-500 pl-4 italic my-6 text-slate-600 dark:text-slate-400;
  }
</style>
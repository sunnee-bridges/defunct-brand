---
// src/components/Timeline.astro
// Props:
// - heading?: string            → Optional H2-style heading above the timeline
// - items: Array<{
//     date?: string | number;    // "2006", "2012-10", "Oct 2012", etc.
//     title: string;             // short label for the event
//     text?: string;             // one-liner (optional)
//     href?: string;             // optional link for "Read more"
//   }>
// - compact?: boolean           → tighter spacing (default: false)
// - class?: string              → additional wrapper classes

export interface TimelineItem {
  date?: string | number;
  title: string;
  text?: string;
  href?: string;
}

const {
  heading = "Timeline",
  items = [] as TimelineItem[],
  compact = false,
  class: className = "",
} = Astro.props as {
  heading?: string;
  items?: TimelineItem[];
  compact?: boolean;
  class?: string;
};

const spacing = compact ? "gap-3 py-3" : "gap-3 py-4 md:py-5";
const dotSize = compact ? "w-2.5 h-2.5" : "w-3 h-3";
const dateCls = "shrink-0 w-28 md:w-32 text-xs md:text-sm font-medium text-slate-600 dark:text-slate-300";
const cardCls =
  "relative rounded-xl border border-slate-200 dark:border-slate-800 bg-white/60 dark:bg-slate-900/60 px-3 py-2 md:px-4 md:py-3";

const cleaned = Array.isArray(items)
  ? items.filter(e => e && (e.title || e.text || e.date))
  : [];
---

{cleaned.length > 0 && (
  <section class={`mt-6 ${className}`} aria-label={heading}>
    <h2 class="text-lg font-semibold mt-2 mb-3">{heading}</h2>

    {/* Vertical rail */}
    <ol class="relative pl-5">
      <span
        aria-hidden="true"
        class="absolute left-2 top-0 bottom-0 w-px bg-slate-200 dark:bg-slate-800"
      ></span>

      {cleaned.map((e, i) => (
        <li class={`relative ${spacing}`}>
          {/* Node dot */}
          <span
            aria-hidden="true"
            class={`absolute left-1.5 ${dotSize} rounded-full bg-indigo-600 ring-2 ring-white dark:ring-slate-900`}
            style="translate: 0 .5rem;"
          ></span>

          <div class="flex items-start gap-3 md:gap-4">
            <div class={dateCls} aria-label="Event date">{e.date ?? ""}</div>

            <div class={cardCls}>
              <div class="text-sm md:text-base font-semibold text-slate-900 dark:text-slate-100">
                {e.title}
              </div>
              {e.text && (
                <p class="mt-1 text-sm text-slate-700 dark:text-slate-300">
                  {e.text}
                </p>
              )}
              {e.href && (
                <a href={e.href} class="inline-flex items-center text-sm mt-2 chip focus-ring">
                  Read more →
                </a>
              )}
            </div>
          </div>
        </li>
      ))}
    </ol>
  </section>
)}
